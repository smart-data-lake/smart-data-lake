"use strict";(self.webpackChunksmart_data_lake=self.webpackChunksmart_data_lake||[]).push([[5070],{5180:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>d,toc:()=>u});var t=r(4848),a=r(8453),l=r(1470),s=r(9365);const i={id:"build",title:"Build SDL"},o=void 0,d={id:"reference/build",title:"Build SDL",description:"Build from Source Code",source:"@site/docs/reference/build.md",sourceDirName:"reference",slug:"/reference/build",permalink:"/docs/reference/build",draft:!1,unlisted:!1,editUrl:"https://github.com/smart-data-lake/smart-data-lake/tree/documentation/docs/reference/build.md",tags:[],version:"current",frontMatter:{id:"build",title:"Build SDL"},sidebar:"tutorialSidebar",previous:{title:"Notes for Windows Users",permalink:"/docs/getting-started/troubleshooting/docker-on-windows"},next:{title:"Command Line",permalink:"/docs/reference/commandLine"}},c={},u=[{value:"Build from Source Code",id:"build-from-source-code",level:2},{value:"Build Dependencies",id:"build-dependencies",level:3},{value:"Releases and snapshots",id:"releases-and-snapshots",level:3},{value:"Start a new project",id:"start-a-new-project",level:3},{value:"Building JAR with Runtime Dependencies",id:"building-jar-with-runtime-dependencies",level:3},{value:"Build an SDL Container",id:"build-an-sdl-container",level:2}];function p(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"build-from-source-code",children:"Build from Source Code"}),"\n",(0,t.jsxs)(n.p,{children:["In the ",(0,t.jsx)(n.a,{href:"/docs/getting-started/setup",children:"getting started guide"})," we used Docker to get you up to speed quickly.\nIf you take a closer look at the ",(0,t.jsx)(n.a,{href:"https://github.com/smart-data-lake/getting-started/blob/master/Dockerfile",children:"Dockerfile"}),",\nyou will see that we simply execute Apache Maven for you to build the jar file and configure an appropriate entrypoint for the container."]}),"\n",(0,t.jsx)(n.p,{children:"In a real world project, you probably want more control over the build process, this page helps you in this case."}),"\n",(0,t.jsxs)(n.p,{children:["Smart Data Lake Builder is build using ",(0,t.jsx)(n.a,{href:"https://maven.apache.org/",children:"Apache Maven"}),".\nHere is an overview of the various versions at play:"]}),"\n",(0,t.jsx)(n.h3,{id:"build-dependencies",children:"Build Dependencies"}),"\n",(0,t.jsx)(n.p,{children:"SDL Version 1.x"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.em,{children:"Spark 2.4"})}),"\n",(0,t.jsx)(n.li,{children:"JDK 8 (Spark 2 doesn't support JDK 9 or higher)"}),"\n",(0,t.jsx)(n.li,{children:"Scala 2.11 or 2.12"}),"\n",(0,t.jsx)(n.li,{children:"Maven 3.0 (or higher)"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"SDL Version 2.x"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.em,{children:"Spark 3.x"})}),"\n",(0,t.jsx)(n.li,{children:"JDK >= 8"}),"\n",(0,t.jsx)(n.li,{children:"Scala 2.12 (Spark 3 doesn't support scala 2.11 anymore)"}),"\n",(0,t.jsx)(n.li,{children:"Maven 3.0 (or higher)"}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"If you don't have strong reasons to still use Spark 2.X, you should use the latest version of Smart Data Lake Builder which comes with Spark 3.X."})}),"\n",(0,t.jsx)(n.h3,{id:"releases-and-snapshots",children:"Releases and snapshots"}),"\n",(0,t.jsxs)(n.p,{children:["You rarely need to build Smart Data Lake Builder yourself.\nWe publish releases regularly on ",(0,t.jsx)(n.a,{href:"https://github.com/smart-data-lake/smart-data-lake/releases",children:"Github"}),".\nThese releases are automatically published on Maven Central and can therefore be used directly.\nOn every merge to the develop branch, we also release snapshot releases to Sonatype, so you can even reference SNAPSHOT releases for cutting edge versions."]}),"\n",(0,t.jsx)(n.h3,{id:"start-a-new-project",children:"Start a new project"}),"\n",(0,t.jsxs)(n.p,{children:["So how do you usually start with a new project?\nTake a look at ",(0,t.jsx)(n.a,{href:"https://github.com/smart-data-lake/sdl-examples",children:"sdl-examples"})," as a template.\nYou start a new Maven project and define our ",(0,t.jsx)(n.code,{children:"sdl-parent"})," as your projects parent:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"<parent>\n    <groupId>io.smartdatalake</groupId>\n    <artifactId>sdl-parent</artifactId>\n    \x3c!--\n        Set the smartdatalake version to use here.\n        If version cannot be resolved, make sure maven central repository is defined in settings.xml and the corresponding profile activated.\n        If version in IntelliJ still cannot be resolved, a restart of IntelliJ might help!\n    --\x3e\n    <version>2.1.1</version>\n</parent>\n"})}),"\n",(0,t.jsx)(n.h3,{id:"building-jar-with-runtime-dependencies",children:"Building JAR with Runtime Dependencies"}),"\n",(0,t.jsxs)(n.p,{children:["With that, you also get all profiles defined in our parent project,\nso it's easy to generate a ",(0,t.jsx)(n.em,{children:(0,t.jsx)(n.strong,{children:"fat-jar"})})," for example (including all dependencies you need).\nWhen deploying to a cluster with Apache Spark preconfigured, you don't need to include this dependency yourself.\nUse the profile ",(0,t.jsx)(n.em,{children:(0,t.jsx)(n.strong,{children:"fat-jar"})})," in this case.",(0,t.jsx)(n.br,{}),"\n","If you want to generate a jar for local execution or somewhere Apache Spark is not provided, use the profile ",(0,t.jsx)(n.em,{children:(0,t.jsx)(n.strong,{children:"fat-jar-with-spark"})})," instead"]}),"\n",(0,t.jsx)(n.h2,{id:"build-an-sdl-container",children:"Build an SDL Container"}),"\n",(0,t.jsxs)(n.p,{children:["To build an SDL container a ",(0,t.jsx)(n.em,{children:"Dockerfile"})," and a ",(0,t.jsx)(n.em,{children:"pom.xml"})," is neccessary. The Dockerfile specifies:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"maven base image, and the openjdk image"}),"\n",(0,t.jsxs)(n.li,{children:["SDL specifiaction, defined in the ",(0,t.jsx)(n.code,{children:"pom.xml"})]}),"\n",(0,t.jsx)(n.li,{children:"log4j property file"}),"\n",(0,t.jsx)(n.li,{children:"entrypoint"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"An example would be:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'#\n# Build stage\n#\nFROM docker.io/maven:3.6.0-jdk-11-slim AS build\nCOPY src /home/app/src\nCOPY pom.xml /home/app\nRUN mvn --quiet -f /home/app/pom.xml -Pcopy-libs package\n\n#\n# Package stage\n# Note that *.jar is provided to the docker image through /mnt/lib and added to the class-path for SDL.\n#\nFROM docker.io/openjdk:11-jre-slim\nCOPY --from=build /home/app/target/lib/*.jar /opt/app/lib/\nCOPY --from=build /home/app/src/main/resources/log4j.properties /home/app/lib/\nENTRYPOINT ["java","-D${CONFIG_OVERWRITE}", "-Duser.dir=/mnt/data","-Dlog4j.configuration=file:/home/app/lib/log4j.properties","-cp","/opt/app/lib/*:/mnt/lib/*","io.smartdatalake.app.LocalSmartDataLakeBuilder"]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Custom Scala Classes for e.g. DataObjects and Transformers, can be build seperately and mounted into the container (into ",(0,t.jsx)(n.code,{children:"/mnt/lib"}),")."]}),"\n",(0,t.jsxs)(l.A,{groupId:"docker-podman-switch",defaultValue:"docker",values:[{label:"Docker",value:"docker"},{label:"Podman",value:"podman"}],children:[(0,t.jsx)(s.A,{value:"docker",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"docker build -t sdl-spark .\n"})})}),(0,t.jsx)(s.A,{value:"podman",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"podman build -t sdl-spark .\n"})})})]}),"\n",(0,t.jsxs)(n.p,{children:["An example including the log4j.properties is also provided in the ",(0,t.jsx)(n.a,{href:"https://github.com/smart-data-lake/getting-started.git",children:"getting-started"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},9365:(e,n,r)=>{r.d(n,{A:()=>s});r(6540);var t=r(53);const a={tabItem:"tabItem_Ymn6"};var l=r(4848);function s(e){let{children:n,hidden:r,className:s}=e;return(0,l.jsx)("div",{role:"tabpanel",className:(0,t.A)(a.tabItem,s),hidden:r,children:n})}},1470:(e,n,r)=>{r.d(n,{A:()=>y});var t=r(6540),a=r(53),l=r(3104),s=r(6347),i=r(205),o=r(7485),d=r(1682),c=r(9466);function u(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:r}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:r,attributes:t,default:a}}=e;return{value:n,label:r,attributes:t,default:a}}))}(r);return function(e){const n=(0,d.X)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,r])}function h(e){let{value:n,tabValues:r}=e;return r.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:r}=e;const a=(0,s.W6)(),l=function(e){let{queryString:n=!1,groupId:r}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:n,groupId:r});return[(0,o.aZ)(l),(0,t.useCallback)((e=>{if(!l)return;const n=new URLSearchParams(a.location.search);n.set(l,e),a.replace({...a.location,search:n.toString()})}),[l,a])]}function f(e){const{defaultValue:n,queryString:r=!1,groupId:a}=e,l=p(e),[s,o]=(0,t.useState)((()=>function(e){let{defaultValue:n,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!h({value:n,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const t=r.find((e=>e.default))??r[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:l}))),[d,u]=m({queryString:r,groupId:a}),[f,b]=function(e){let{groupId:n}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(n),[a,l]=(0,c.Dv)(r);return[a,(0,t.useCallback)((e=>{r&&l.set(e)}),[r,l])]}({groupId:a}),j=(()=>{const e=d??f;return h({value:e,tabValues:l})?e:null})();(0,i.A)((()=>{j&&o(j)}),[j]);return{selectedValue:s,selectValue:(0,t.useCallback)((e=>{if(!h({value:e,tabValues:l}))throw new Error(`Can't select invalid tab value=${e}`);o(e),u(e),b(e)}),[u,b,l]),tabValues:l}}var b=r(2303);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=r(4848);function g(e){let{className:n,block:r,selectedValue:t,selectValue:s,tabValues:i}=e;const o=[],{blockElementScrollPositionUntilNextRender:d}=(0,l.a_)(),c=e=>{const n=e.currentTarget,r=o.indexOf(n),a=i[r].value;a!==t&&(d(n),s(a))},u=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const r=o.indexOf(e.currentTarget)+1;n=o[r]??o[0];break}case"ArrowLeft":{const r=o.indexOf(e.currentTarget)-1;n=o[r]??o[o.length-1];break}}n?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":r},n),children:i.map((e=>{let{value:n,label:r,attributes:l}=e;return(0,x.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>o.push(e),onKeyDown:u,onClick:c,...l,className:(0,a.A)("tabs__item",j.tabItem,l?.className,{"tabs__item--active":t===n}),children:r??n},n)}))})}function v(e){let{lazy:n,children:r,selectedValue:a}=e;const l=(Array.isArray(r)?r:[r]).filter(Boolean);if(n){const e=l.find((e=>e.props.value===a));return e?(0,t.cloneElement)(e,{className:"margin-top--md"}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:l.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==a})))})}function k(e){const n=f(e);return(0,x.jsxs)("div",{className:(0,a.A)("tabs-container",j.tabList),children:[(0,x.jsx)(g,{...e,...n}),(0,x.jsx)(v,{...e,...n})]})}function y(e){const n=(0,b.A)();return(0,x.jsx)(k,{...e,children:u(e.children)},String(n))}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>i});var t=r(6540);const a={},l=t.createContext(a);function s(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);