"use strict";(self.webpackChunksmart_data_lake=self.webpackChunksmart_data_lake||[]).push([[4121],{958:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var r=n(4848),a=n(8453);n(1470),n(9365);const o={title:"Joining It Together"},i=void 0,s={id:"getting-started/part-1/joining-it-together",title:"Joining It Together",description:"Goal",source:"@site/docs/getting-started/part-1/joining-it-together.md",sourceDirName:"getting-started/part-1",slug:"/getting-started/part-1/joining-it-together",permalink:"/docs/getting-started/part-1/joining-it-together",draft:!1,unlisted:!1,editUrl:"https://github.com/smart-data-lake/smart-data-lake/tree/documentation/docs/getting-started/part-1/joining-it-together.md",tags:[],version:"current",frontMatter:{title:"Joining It Together"},sidebar:"tutorialSidebar",previous:{title:"Select Columns",permalink:"/docs/getting-started/part-1/select-columns"},next:{title:"Get Departure Coordinates",permalink:"/docs/getting-started/part-1/joining-departures-and-arrivals"}},l={},u=[{value:"Goal",id:"goal",level:2},{value:"Define output object",id:"define-output-object",level:2},{value:"Define join_departures_airports action",id:"define-join_departures_airports-action",level:2},{value:"Try it out",id:"try-it-out",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h2,{id:"goal",children:"Goal"}),"\n",(0,r.jsxs)(t.p,{children:["So now we have data from departures in our stage layer, and we have cleaned data for airports in our integration layer.\nIn this step we will finally join both data sources together.\nWe will continue based on the airports.conf file available ",(0,r.jsx)(t.a,{href:"https://github.com/smart-data-lake/getting-started/tree/master/config/airports.conf.part-1c-solution",children:"here"}),".\nAt the end of the step, we will have all planes departing from Bern Airport in the given timeframe along with their readable destination airport names, as well as geo-coordinates."]}),"\n",(0,r.jsx)(t.p,{children:"Like in the previous step, we need one more action and one DataObject for our output.\nFor the transformations we will use the btl.conf file:"}),"\n",(0,r.jsx)(t.h2,{id:"define-output-object",children:"Define output object"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'  btl-connected-airports {\n    type = CsvFileDataObject\n    path = "~{id}"\n  }\n'})}),"\n",(0,r.jsx)(t.h2,{id:"define-join_departures_airports-action",children:"Define join_departures_airports action"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'  join-departures-airports {\n    type = CustomDataFrameAction\n    inputIds = [stg-departures, int-airports]\n    outputIds = [btl-connected-airports]\n    transformers = [{\n      type = SQLDfsTransformer\n      code = {\n        btl-connected-airports = """\n          select stg_departures.estdepartureairport, stg_departures.estarrivalairport, airports.*\n          from stg_departures join int_airports airports on stg_departures.estArrivalAirport = airports.ident\n        """\n      }\n    }]\n    metadata {\n      feed = compute\n    }\n  }\n'})}),"\n",(0,r.jsx)(t.p,{children:"Now it gets interesting, a couple of things to note here:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"This time, we changed the Action Type from CopyAction to CustomDataFrameAction.\nUse CustomDataFrameAction when you need to do complex operations. For instance, CustomDataFrameAction allows multiple inputs,\nwhich CopyAction does not."}),"\n",(0,r.jsxs)(t.li,{children:["Our input/output fields are now called inputId",(0,r.jsx)(t.strong,{children:"s"})," and outputId",(0,r.jsx)(t.strong,{children:"s"})," and they take a list of DataObject ids.\nSimilarly, our transformer is now of type SQLDf",(0,r.jsx)(t.strong,{children:"s"}),"Transformer.\nAgain, the ",(0,r.jsx)(t.strong,{children:"s"})," is important, since it shows that multiple inputs/output Data Objects are possible, which is what we need in this step.\nIn the previous step, we defined a SQLDfTransformer because we only needed one input."]}),"\n",(0,r.jsxs)(t.li,{children:["Finally, the ",(0,r.jsx)(t.em,{children:"SQLDfsTransformer"})," expects its code as a HOCON object rather than as a string.\nThis is due to the fact that you could have multiple\noutputs, in which case you would need to name them in order to distinguish them.\nIn our case, there is only one output DataObject: ",(0,r.jsx)(t.em,{children:"btl-connected-airports"}),".\nThe SQL-Code itself is just a join between the two input Data Objects on the ICAO identifier.\nNote that we can just select all columns from airports, since we selected the ones that interest us in the previous step."]}),"\n"]}),"\n",(0,r.jsx)(t.admonition,{title:"Use only one output",type:"tip",children:(0,r.jsxs)(t.p,{children:["As you can see, with CustomDataFrameAction it's possible to read from multiple inputs and write to multiple outputs.\nWe usually discourage writing to multiple Data Objects in one action though.\nAt some point, you will want to use the metadata from SDLB to analyze your data lineage. If you have a CustomDataFrameAction\nwith multiple inputs and multiple outputs (an M",":N-relationship","), SDLB assumes that all outputs depend on all inputs. This might add\nsome dependencies between DataObjects that don't really exist in the CustomDataFrameAction.\nAlways using one Data Object as output will make your data lineage more detailed and clear."]})}),"\n",(0,r.jsx)(t.h2,{id:"try-it-out",children:"Try it out"}),"\n",(0,r.jsxs)(t.p,{children:["You can run the usual ",(0,r.jsx)(t.em,{children:"./startJob.sh"})," command:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"./startJob.sh -c /mnt/config --feed-sel compute\n"})}),"\n",(0,r.jsxs)(t.p,{children:["You should now see the resulting files in ",(0,r.jsx)(t.em,{children:"data/btl-connected-airports"}),".\nGreat! Now we have names and coordinates of destination airports.\nWe are just missing the coordinates of Bern Airport.\nLet's add them in the next step."]})]})}function d(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},9365:(e,t,n)=>{n.d(t,{A:()=>i});n(6540);var r=n(53);const a={tabItem:"tabItem_Ymn6"};var o=n(4848);function i(e){let{children:t,hidden:n,className:i}=e;return(0,o.jsx)("div",{role:"tabpanel",className:(0,r.A)(a.tabItem,i),hidden:n,children:t})}},1470:(e,t,n)=>{n.d(t,{A:()=>x});var r=n(6540),a=n(53),o=n(3104),i=n(6347),s=n(205),l=n(7485),u=n(1682),c=n(9466);function d(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??function(e){return d(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:a}}=e;return{value:t,label:n,attributes:r,default:a}}))}(n);return function(e){const t=(0,u.X)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function h(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:n}=e;const a=(0,i.W6)(),o=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l.aZ)(o),(0,r.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(a.location.search);t.set(o,e),a.replace({...a.location,search:t.toString()})}),[o,a])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,o=p(e),[i,l]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!h({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:o}))),[u,d]=m({queryString:n,groupId:a}),[f,g]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,o]=(0,c.Dv)(n);return[a,(0,r.useCallback)((e=>{n&&o.set(e)}),[n,o])]}({groupId:a}),b=(()=>{const e=u??f;return h({value:e,tabValues:o})?e:null})();(0,s.A)((()=>{b&&l(b)}),[b]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!h({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),g(e)}),[d,g,o]),tabValues:o}}var g=n(2303);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=n(4848);function v(e){let{className:t,block:n,selectedValue:r,selectValue:i,tabValues:s}=e;const l=[],{blockElementScrollPositionUntilNextRender:u}=(0,o.a_)(),c=e=>{const t=e.currentTarget,n=l.indexOf(t),a=s[n].value;a!==r&&(u(t),i(a))},d=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;t=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;t=l[n]??l[l.length-1];break}}t?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":n},t),children:s.map((e=>{let{value:t,label:n,attributes:o}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:r===t?0:-1,"aria-selected":r===t,ref:e=>l.push(e),onKeyDown:d,onClick:c,...o,className:(0,a.A)("tabs__item",b.tabItem,o?.className,{"tabs__item--active":r===t}),children:n??t},t)}))})}function w(e){let{lazy:t,children:n,selectedValue:a}=e;const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:o.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a})))})}function y(e){const t=f(e);return(0,j.jsxs)("div",{className:(0,a.A)("tabs-container",b.tabList),children:[(0,j.jsx)(v,{...e,...t}),(0,j.jsx)(w,{...e,...t})]})}function x(e){const t=(0,g.A)();return(0,j.jsx)(y,{...e,children:d(e.children)},String(t))}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>s});var r=n(6540);const a={},o=r.createContext(a);function i(e){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);