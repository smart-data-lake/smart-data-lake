"use strict";(self.webpackChunksmart_data_lake=self.webpackChunksmart_data_lake||[]).push([[3933],{4174:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var n=r(4848),a=r(8453);const i={title:"Get Departure Coordinates"},o=void 0,s={id:"getting-started/part-1/joining-departures-and-arrivals",title:"Get Departure Coordinates",description:"Goal",source:"@site/docs/getting-started/part-1/joining-departures-and-arrivals.md",sourceDirName:"getting-started/part-1",slug:"/getting-started/part-1/joining-departures-and-arrivals",permalink:"/docs/getting-started/part-1/joining-departures-and-arrivals",draft:!1,unlisted:!1,editUrl:"https://github.com/smart-data-lake/smart-data-lake/tree/documentation/docs/getting-started/part-1/joining-departures-and-arrivals.md",tags:[],version:"current",frontMatter:{title:"Get Departure Coordinates"},sidebar:"tutorialSidebar",previous:{title:"Joining It Together",permalink:"/docs/getting-started/part-1/joining-it-together"},next:{title:"Compute Distances",permalink:"/docs/getting-started/part-1/compute-distances"}},d={},l=[{value:"Goal",id:"goal",level:2},{value:"Define join_departures_airports action",id:"define-join_departures_airports-action",level:2},{value:"Define output object",id:"define-output-object",level:2},{value:"Try it out",id:"try-it-out",level:2}];function c(e){const t={a:"a",code:"code",em:"em",h2:"h2",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"goal",children:"Goal"}),"\n",(0,n.jsxs)(t.p,{children:["In this step we will extend the ",(0,n.jsx)(t.a,{href:"https://github.com/smart-data-lake/getting-started/tree/master/config/btl.conf.part-1a-solution",children:"btl.conf"}),"\nfile of the previous step, so that we get the coordinates and the readable name of Bern Airport in our final data.\nSince we are dealing with just one record, we could manually add it to the data set.\nBut what if we wanted to extend our project to other departure airports in the future?\nWe'll do it in a generic way by adding another transformer into the action ",(0,n.jsx)(t.em,{children:"join_departures_airports"})]}),"\n",(0,n.jsx)(t.h2,{id:"define-join_departures_airports-action",children:"Define join_departures_airports action"}),"\n",(0,n.jsx)(t.p,{children:"Let's start in an unusual way by first changing the action. You'll see why shortly."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:'  join-departures-airports {\n    type = CustomDataFrameAction\n    inputIds = [stg-departures, int-airports]\n    outputIds = [btl-departures-arrivals-airports]\n    transformers = [{\n      type = SQLDfsTransformer\n      code = {\n        btl-connected-airports = """\n          select stg_departures.estdepartureairport, stg_departures.estarrivalairport, airports.*\n          from stg_departures join int_airports airports on stg_departures.estArrivalAirport = airports.ident\n        """\n      }\n    },{\n      type = SQLDfsTransformer\n      code = {\n        btl-departures-arrivals-airports = """\n          select btl_connected_airports.estdepartureairport, btl_connected_airports.estarrivalairport,\n            btl_connected_airports.name as arr_name, btl_connected_airports.latitude_deg as arr_latitude_deg, btl_connected_airports.longitude_deg as arr_longitude_deg,\n            airports.name as dep_name, airports.latitude_deg as dep_latitude_deg, airports.longitude_deg as dep_longitude_deg\n          from btl_connected_airports join int_airports airports on btl_connected_airports.estdepartureairport = airports.ident\n        """\n      }\n      description = "Get the name and coordinates of the departures airport"\n    }]\n    metadata {\n      feed = compute\n    }\n  }\n'})}),"\n",(0,n.jsxs)(t.p,{children:["We added a second transformer of the type SQLDfsTransformer.\nIt's SQL Code references the result of the first transformer: ",(0,n.jsx)(t.em,{children:"btl-connected-airports"})," (remember the underscores, so ",(0,n.jsx)(t.em,{children:"btl_connected_airports"})," in SparkSQL).\nSDLB will execute these transformations in the order you defined them, which allows you to chain them together, like we have done."]}),"\n",(0,n.jsxs)(t.p,{children:["In the second SQL-Code, we join the result of the first SQL again with int_airports, but this time using ",(0,n.jsx)(t.em,{children:"estdepartureairport"})," as key\nto get the name and coordinates of the departures airport, Bern Airport. We can this as a description of the transformer, so it is available as metadata later."]}),"\n",(0,n.jsxs)(t.p,{children:["We also renamed these columns so that they are distinguishable from the names and coordinates of the arrival airports.\nFinally, we put the result into a DataObject called ",(0,n.jsx)(t.em,{children:"btl-departures-arrivals-airports"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"define-output-object",children:"Define output object"}),"\n",(0,n.jsx)(t.p,{children:"Let's add the new DataObject, as usual:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:'  btl-departures-arrivals-airports {\n    type = CsvFileDataObject\n    path = "~{id}"\n  }\n'})}),"\n",(0,n.jsx)(t.p,{children:"Now we can simply delete the DataObject btl-connected-airports, because it is now only a temporary result within an action.\nThis is a key difference between chaining actions and chaining transformations within the same action:\nyou don't have intermediary results.\nAnother difference is that you cannot run an individual transformation alone, you can only run entire actions."}),"\n",(0,n.jsx)(t.h2,{id:"try-it-out",children:"Try it out"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://github.com/smart-data-lake/getting-started/tree/master/config/btl.conf.part-1b-solution",children:"This"})," is how your btl.conf should look like by now."]}),"\n",(0,n.jsx)(t.p,{children:"When running the example, you should see a CSV file with departure and arrival airport names and coordinates."}),"\n",(0,n.jsx)(t.p,{children:"Great! Now we have all the data we need in one place. The only thing left to do is to compute the distance\nbetween departure and arrival coordinates. Let's do that in the final step of part 1."})]})}function p(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,t,r)=>{r.d(t,{R:()=>o,x:()=>s});var n=r(6540);const a={},i=n.createContext(a);function o(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);