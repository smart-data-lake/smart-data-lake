<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-reference/transformations" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Transformations | Smart Data Lake Builder</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.smartdatalake.ch/docs/reference/transformations"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Transformations | Smart Data Lake Builder"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.smartdatalake.ch/docs/reference/transformations"><link data-rh="true" rel="alternate" href="https://www.smartdatalake.ch/docs/reference/transformations" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.smartdatalake.ch/docs/reference/transformations" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UOM3ZOMCU0-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Smart Data Lake Builder RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Smart Data Lake Builder Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Smart Data Lake Builder" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.882ac319.css">
<script src="/assets/js/runtime~main.1c67a992.js" defer="defer"></script>
<script src="/assets/js/main.57b8011f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/sdl_logo.png" alt="Smart Data Lake Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/sdl_logo.png" alt="Smart Data Lake Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Smart Data Lake</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/json-schema-viewer">SchemaViewer</a><a href="https://ui-demo.smartdatalake.ch/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">UI-Demo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/">Smart Data Lake</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/getting-started/setup">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/reference/build">Reference</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/build">Build SDL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/commandLine">Command Line</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/reference/dataObjects">SDLB objects</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/reference/hoconOverview">Hocon Configuration</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/dag">DAG</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/schema">Schema</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/schema-viewer-navigation">Schema Viewer Usage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/dataQuality">Data Quality</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/executionPhases">Execution Phases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/executionEngines">Execution Engines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/executionModes">Execution Modes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/reference/transformations">Transformations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/streaming">Streaming</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/reference/deploymentOptions">Deployment</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/testing">Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/notebookCatalog">Use in Notebooks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/troubleshooting">Troubleshooting</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/json-schema-viewer">Configuration Schema Viewer</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Reference</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Transformations</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Transformations</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>On all Spark related actions, you can add one or multiple transformers that are used to transform data before handing
it over to the next action or writing the Data Object.
If you define multiple transformers for one action, they are processed sequentially (output of one transformer becomes input of the next).
This page describes the many out-of-the-box transformations and explains how to write your own.</p>
<p>In all cases, two types of transformers need to be distinguished:</p>
<ul>
<li><strong>1-to-1</strong>: One input Data Object is transformed into one output Data Object.</li>
<li><strong>many-to-many</strong>: One or more input Data Objects are transformed into (potentially) many output Data Object.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Although it&#x27;s possible to create many output Data Object, it&#x27;s encouraged to only create actions with one output Data Object.
The resulting lineage of the pipelines will be clearer and impact analysis easier.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h4>
<p>As a simple example, we add a WhitelistTransformer to a CopyAction.
This will result in only the given columns being selected from the input Data Object and any other columns being discarded.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">SampleWhitelistAction {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    type = CopyAction</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    inputId = someInput</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    outputId = someOutput</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    transformers = [{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        type = WhitelistTransformer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        columnWhitelist = [includedColumn1,anotherColumn2]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note the square brackets: <em>transformers</em> is an array as you can define multiple transformers.</p>
<p>The parameter <code>columnWhitelist</code> is dependent on the type of the transformer.
For details about given parameters / options, please see the <a href="/json-schema-viewer">Configuration Schema Viewer</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="predefined-transformations">Predefined Transformations<a href="#predefined-transformations" class="hash-link" aria-label="Direct link to Predefined Transformations" title="Direct link to Predefined Transformations">​</a></h2>
<p>SDLB comes with commonly used transformers out-of-the-box.</p>
<p>The following predefined 1-to-1 transformations are supported:</p>
<table><thead><tr><th>Transformer</th><th>Description</th></tr></thead><tbody><tr><td>AdditionalColumnsTransformer</td><td>Add additional columns to the DataFrame by extracting information from the context  or derive new columns from existing columns</td></tr><tr><td>BlacklistTransformer</td><td>Apply a column blacklist to discard columns</td></tr><tr><td>DataValidationTransformer</td><td>validates DataFrame with a user defined set of rules and creates column with potential error messages</td></tr><tr><td>DecryptColumnsTransformer</td><td>Decrypts specified columns using AES/GCM algorithm</td></tr><tr><td>EncryptColumnsTransformer</td><td>Encrypts specified columns using AES/GCM algorithm</td></tr><tr><td>FilterTransformer</td><td>Filter DataFrame with expression</td></tr><tr><td>SparkRepartitionTransformer</td><td>Repartitons a DataFrame</td></tr><tr><td>StandardizeColNamesTransformer</td><td>Used to standardize column names according to configurable rules</td></tr><tr><td>StandardizeSparkDatatypesTransformer</td><td>Standardize data types of a DataFrame (decimal to corresponding int / float)</td></tr><tr><td>WhitelistTransformer</td><td>Apply a column whitelist to a DataFrame</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="custom-transformations">Custom Transformations<a href="#custom-transformations" class="hash-link" aria-label="Direct link to Custom Transformations" title="Direct link to Custom Transformations">​</a></h2>
<p>When these predefined transformations are not enough, you can easily write your own <em>Custom Transformations</em>.
SDLB currently supports SQL, Scala and Python transformations, depending on the complexity and needed libraries.</p>
<p>The following custom transformations are available.</p>
<table><thead><tr><th>Transformer</th><th>Description</th></tr></thead><tbody><tr><td>SQLDfTransformer</td><td>SQL Transformation 1-to-1</td></tr><tr><td>SQLDfsTransformer</td><td>SQL Transformation many-to-many</td></tr><tr><td>ScalaClassGenericDfTransformer</td><td>Spark DataFrame transformation in Scala 1-to-1</td></tr><tr><td>ScalaClassGenericDfsTransformer</td><td>Spark DataFrame transformation in Scala many-to-many</td></tr><tr><td>ScalaClassSnowparkDfTransformer</td><td>Snowpark (Snowflake) transformation in Scala 1-to-1</td></tr><tr><td>ScalaClassSnowparkDfsTransformer</td><td>Snowpark (Snowflake) transformation in Scala many-to-many</td></tr><tr><td>ScalaClassSparkDfTransformer</td><td>Spark DataFrame transformation in Scala 1-to-1</td></tr><tr><td>ScalaClassSparkDfsTransformer</td><td>Spark DataFrame transformation in Scala many-to-many</td></tr><tr><td>ScalaClassSparkDsTransformer</td><td>Spark DataSet transformation in Scala 1-to-1</td></tr><tr><td>ScalaClassSparkDsNTo1Transformer</td><td>Spark DataFrame transformation in Scala many-to-one</td></tr><tr><td>ScalaNotebookSparkDfTransformer</td><td>Loads custom code from a Notebook</td></tr><tr><td>PythonCodeSparkDfTransformer</td><td>Spark DataFrame transformation in Python 1-to-1 (using PySpark)</td></tr><tr><td>PythonCodeSparkDfsTransformer</td><td>Spark DataFrame transformation in Python many-to-many (using PySpark)</td></tr></tbody></table>
<p>There are usually two variants, one for 1-to-1 transformations called <em>DfTransformer</em> and one
for many-to-many transformations called <em>DfsTransformer</em>.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The type of the transformer needs to match your action.
This is also apparent in the <a href="/json-schema-viewer">Configuration Schema Viewer</a>:<br>
<!-- -->1-to-1 transformers are listed under 1-to-1 actions, i.e. CopyAction.<br>
<!-- -->Many-to-many transformers are only listed under many-to-many actions, i.e. CustomDataFrameAction.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sql">SQL<a href="#sql" class="hash-link" aria-label="Direct link to SQL" title="Direct link to SQL">​</a></h3>
<p>Spark SQL is probably the easiest way to write a custom transformation, directly in your HOCON configuration.
All input Data Objects are available in the select statement with following naming:</p>
<ul>
<li>special characters are replaced by an underscore</li>
<li>a postfix <code>_sdltemp</code> is added.
So an input Data Object called <code>table-with-hyphen</code> becomes <code>table_with_hyphen_sdltemp</code> inside the SQL query.
To simplify this you can also use the special token <code>%{inputViewName}</code> for 1-to-1 transformations, or <code>${inputViewName_&lt;inputDataObjectName&gt;}</code> for n-to-m transformations, that will be replaced with the correct name at runtime.</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="sql-1-to-1">SQL 1-to-1<a href="#sql-1-to-1" class="hash-link" aria-label="Direct link to SQL 1-to-1" title="Direct link to SQL 1-to-1">​</a></h5>
<p>1-to-1 transformations use type SQLDfTransformer.</p>
<p>Let&#x27;s assume we have an input Data Object called dataObject1.
We can then write a SQL transformation directly in our HOCON configuration:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">transformers = [{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  type = SQLDfTransformer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  sqlCode = &quot;select id, count(*) from %{inputViewName} group by id&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The SQL code gets executed in Spark SQL so you can use all available functions.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="sql-many-to-many">SQL many-to-many<a href="#sql-many-to-many" class="hash-link" aria-label="Direct link to SQL many-to-many" title="Direct link to SQL many-to-many">​</a></h5>
<p>Many-to-many transformations use SQLDfsTransformer (note the additional s in Dfs).
Now that we have multiple output Data Objects, we need to declare which SQL statements belongs to
which Data Object.
Therefore, we now have a map of objectIds and corresponding SQL statements:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">transformers = [{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  type = SQLDfsTransformer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  code = {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    dataObjectOut1 = &quot;select id, cnt from %{inputViewName_dataObjectIn1} where group = &#x27;test1&#x27;&quot;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    dataObjectOut2 = &quot;select id, cnt from %{inputViewName_dataObjectIn1} where group = &#x27;test2&#x27;&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scala">Scala<a href="#scala" class="hash-link" aria-label="Direct link to Scala" title="Direct link to Scala">​</a></h3>
<p>Once transformations get more complex, it&#x27;s more convenient to implement them in Scala code.
In custom Scala code, the whole Spark Dataset API is available.
It&#x27;s of course also possible to include additional libraries for your code,
so anything you can do in Spark Scala, you can do with SDLB.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="as-scala-class-1-to-1">As Scala class 1-to-1<a href="#as-scala-class-1-to-1" class="hash-link" aria-label="Direct link to As Scala class 1-to-1" title="Direct link to As Scala class 1-to-1">​</a></h5>
<p>If you have a Java/Scala project, it usually makes sense to create separate classes for your custom Scala code.
Any classes in your classpath are picked up and can be referenced.</p>
<p>To transform data in a 1-to-1 action, i.e. CopyAction:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  my_action {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    type = CopyAction</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    inputId = stg_input</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    outputId = int_output</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    transformers = [{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      type = ScalaClassSparkDfTransformer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      className = io.package.MyFirstTransformer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now SDLB expects to find a class <em>MyFirstTransformer</em> in the Scala package <em>io.package</em>.
The class needs to extend CustomDfTransformer and with that, overwrite the transform method from it:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">class MyFirstTransformer extends CustomDfTransformer {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    override def transform(session: SparkSession, options: Map[String, String], df: DataFrame, dataObjectId: String) : DataFrame {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        // manipulate df</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        val dfExtended = df.withColumn(&quot;newColumn&quot;, when($&quot;df.desc&quot;.isNotNull, $&quot;df.desc&quot;).otherwise(lit(&quot;na&quot;)))</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        dfExtended</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <em>transform</em> method you need to overwrite receives a single DataFrame called <em>df</em>.
You can manipulate this DataFrame any way you want.
In the end, you simply need to return a DataFrame back to SDLB.</p>
<p>Because a CopyAction is 1-to-1 only, the transformer also needs to extend the 1-to-1 <code>CustomDfTransformer</code>.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="as-scala-class-many-to-many">As Scala class many-to-many<a href="#as-scala-class-many-to-many" class="hash-link" aria-label="Direct link to As Scala class many-to-many" title="Direct link to As Scala class many-to-many">​</a></h5>
<p>If you have a many-to-many action and want to write a custom Scala transformer, you need to switch to a <code>CustomDataFrameAction</code>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">my_many_to_many_action {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  type = CustomDataFrameAction</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  inputIds = [obj1,obj2]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  outputIds = [out]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  transformers = [{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    type = ScalaClassSparkDfsTransformer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    class-name = io.package.MySecondTransformer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this case, your Scala class also needs to extend the many-to-many <code>CustomDfsTransformer</code>. You can either overwrite the respective transform method as shown later,
or define any transform method that suits you best (starting from SDLB version 2.6.x).</p>
<p>If you choose to implement any transform method, this method is called dynamically by looking for the parameter values in the input DataFrames and Options.
The limitation is that the parameter types must be chosen from the following list:</p>
<ul>
<li><code>SparkSession</code></li>
<li><code>Map[String,String]</code></li>
<li><code>DataFrame</code></li>
<li><code>Dataset[&lt;Product&gt;]</code></li>
<li>any primitive data type (<code>String</code>, <code>Boolean</code>, <code>Int</code>, ...)</li>
</ul>
<p>Primitive value parameters are assigned looking up the parameter name in the Map of Options and converted to the target data type.
Data types for primitive values might also use default values or be enclosed in an Option[...] to mark it as non required.</p>
<p>DataFrame parameters are assigned looking up the parameter name in the Map of DataFrames. A potential <code>df</code> prefix is removed from the parameter name before the lookup.</p>
<p>All lookups of parameters are done case-insensitive, also dash and underscores are removed.</p>
<p>If the Action has only one output DataObject, the return type can also be defined as a simple DataFrame instead of a <code>Map[String,DataFrame]</code>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">class MySecondTransformer extends CustomDfsTransformer {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    def transform(session: SparkSession, dfObj1: DataFrame, dfObj2: DataFrame, parameter123: Boolean = true) : DataFrame {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        // now you have multiple input DataFrames and can potentially return multiple DataFrames</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        val dfCombined = dfObj1.join(dfObj2, $&quot;dfObj1.id&quot;==$&quot;dfObj2.fk&quot;, &quot;left&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        dfCombined // use a Map[String,DataFrame] to return multiple DataFrames.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Overwriting the standard transform (traditional way) is done as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">class MySecondTransformer extends CustomDfsTransformer {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    override def transform(session: SparkSession, options: Map[String,String], dfs: Map[String,DataFrame]) : Map[String,DataFrame] {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        // now you have multiple input DataFrames and can potentially return multiple DataFrames</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        val dfObj1 = dfs(&quot;obj1&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        val dfObj2 = dfs(&quot;obj2&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        val dfCombined = dfObj1.join(dfObj2, $&quot;dfObj1.id&quot;==$&quot;dfObj2.fk&quot;, &quot;left&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Map(&quot;out&quot;-&gt;dfCombined)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <em>transform</em> method now gets a map with all your input DataFrames called <em>dfs</em>.
The key in <em>dfs</em> contains the dataObjectId, in this example we have two inputs called <em>obj1</em> and <em>obj2</em>,
we use it to extract the two DataFrames.
Again, you can manipulate all DataFrames as needed and this time, return a map with all output Data Objects.
As noted, it&#x27;s best practice to only return one Data Object (many-to-one action) as in our example.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>One thing that might be confusing at this point:</p><p>CustomDataFrameAction is the type of the <strong>action</strong> itself.
Take a look at the  <a href="/json-schema-viewer">Configuration Schema Viewer</a>:
You will see CustomDataFrameAction as a direct action type, similar to CopyAction or HistorizeAction.</p><p>ScalaClassSparkDfsTransformer is the type of your <strong>transformer</strong>.
It needs to correspond to the action type. A 1-to-1 action expects a 1-to-1 transformer, a many-to-many action expects a many-to-many transformer.</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="in-configuration">In Configuration<a href="#in-configuration" class="hash-link" aria-label="Direct link to In Configuration" title="Direct link to In Configuration">​</a></h5>
<p>If you don&#x27;t work with a full Java/Scala project, it&#x27;s still possible to define your transformations
in your HOCON configuration and compile it at runtime.
In this case, use the transformer type ScalaCodeSparkDfTransformer.</p>
<p>To include the Scala code inline:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">myActionName {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  type = CopyAction</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  inputId = stg-tbl1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  outputId = int-tbl1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  transformers = [{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    type = ScalaCodeSparkDfTransformer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    code = &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      import org.apache.spark.sql.{DataFrame, SparkSession}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      import org.apache.spark.sql.functions.explode</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      (session: SparkSession, options: Map[String,String], df: DataFrame, dataObjectId: String) =&gt; {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        import session.implicits._</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        df.select(&quot;col1&quot;,&quot;col2&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Check the method signature in CustomDfTransformer and CustomDfsTransformer according to your requirements.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="python">Python<a href="#python" class="hash-link" aria-label="Direct link to Python" title="Direct link to Python">​</a></h3>
<p>The transformer needs to use type <code>PythonCodeSparkDfTransformer</code> (1-to-1) or <code>PythonCodeSparkDfsTransformer</code> (many-to-many).
You can either provide it as separate file or inline as Python code again.</p>
<p>Inline 1-to-1 example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">transformers = [{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  type = PythonCodeDfTransformer </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  code = &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    |from pyspark.sql.functions import *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    |udf_multiply = udf(lambda x, y: x * y, &quot;int&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    |dfResult = inputDf.select(col(&quot;name&quot;), col(&quot;cnt&quot;))\</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    |  .withColumn(&quot;test&quot;, udf_multiply(col(&quot;cnt&quot;).cast(&quot;int&quot;), lit(2)))</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    |setOutputDf(dfResult)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>PySpark is initialized automatically and the PySpark session is available under the variables
<code>sc</code>, <code>session</code> or <code>sqlContext</code>.
Some additional variables are also available:</p>
<ul>
<li><code>inputDf</code>: Input DataFrame</li>
<li><code>dataObjectId</code>: Id of input DataObject as string</li>
</ul>
<p>The output DataFrame needs to be set with <code>setOutputDf(df)</code>.</p>
<p>And many-to-many inline example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">transformers = [{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  type = PythonCodeDfsTransformer </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  code = &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    |dfResult = inputDfs[df1].join(inputDfs[df2], inputDfs[df1].id == inputDfs[df2].fk, &quot;left&quot;) \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    |  .select(inputDfs[df1].id, inputDfs[df1].desc, inputDfs[df2].desc)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    |setOutputDf({&quot;outputId&quot;: dfResult})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this case, <code>inputDfs</code> is a dictionary (dict) and <code>setOutputDf</code> expects a dictionary.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a href="#requirements" class="hash-link" aria-label="Direct link to Requirements" title="Direct link to Requirements">​</a></h5>
<p>Running Python transformations needs some additional setup.
In general, Python &gt;= 3.4 is required and PySpark package needs to be installed with a version matching your SDL spark version. Further environment variable PYTHONPATH needs to be set to your python environment <code>.../Lib/site-packages</code> directory, and pyspark command needs to be accessible from the PATH environment variable.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="options--runtimeoptions">Options / RuntimeOptions<a href="#options--runtimeoptions" class="hash-link" aria-label="Direct link to Options / RuntimeOptions" title="Direct link to Options / RuntimeOptions">​</a></h3>
<p>So far these transformations have been quite static:
Code written can probably only be used for one specific action.</p>
<p>For custom transformers, you can therefore provide additional options:</p>
<ul>
<li><code>options</code>: static options provided in your HOCON configuration</li>
<li><code>runtimeOptions</code>: extracted at runtime from the context.</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="in-sql">In SQL<a href="#in-sql" class="hash-link" aria-label="Direct link to In SQL" title="Direct link to In SQL">​</a></h5>
<p>If you want to use options in SQL, the syntax is %{key}:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">transformers = [{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  type = SQLDfTransformer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  sqlCode = &quot;select id, cnt, &#x27;%{test}&#x27; as test, %{last_run_id} as last_run_id from dataObject1&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  options = {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    test = &quot;test run&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  runtimeOptions = {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    last_run_id = &quot;runId - 1&quot; // runtime options are evaluated as spark SQL expressions against DefaultExpressionData</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="in-scala">In Scala<a href="#in-scala" class="hash-link" aria-label="Direct link to In Scala" title="Direct link to In Scala">​</a></h5>
<p>If you check the signature of the <code>transform</code> method again, you can see that you get more than just the DataFrames
you can manipulate.
You also get a Map[String,String] called <code>options</code>.
This Map contains the combined <code>options</code> and <code>runtimeOptions</code>.
So in your custom class, you can read all options and runtimeOptions and use them accordingly to parametrize your code.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="in-python">In Python<a href="#in-python" class="hash-link" aria-label="Direct link to In Python" title="Direct link to In Python">​</a></h5>
<p>Similarly in Python, in addition to the variables <code>inputDf</code> and <code>dataObjectId</code> (resp. <code>inputsDfs</code>), you get a variable called <code>options</code>
containing all <code>options</code> and <code>runtimeOptions</code>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/smart-data-lake/smart-data-lake/tree/documentation/docs/reference/transformations.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/reference/executionModes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Execution Modes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/reference/streaming"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Streaming</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#predefined-transformations" class="table-of-contents__link toc-highlight">Predefined Transformations</a></li><li><a href="#custom-transformations" class="table-of-contents__link toc-highlight">Custom Transformations</a><ul><li><a href="#sql" class="table-of-contents__link toc-highlight">SQL</a></li><li><a href="#scala" class="table-of-contents__link toc-highlight">Scala</a></li><li><a href="#python" class="table-of-contents__link toc-highlight">Python</a></li><li><a href="#options--runtimeoptions" class="table-of-contents__link toc-highlight">Options / RuntimeOptions</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">Getting started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/smart-data-lake/smart-data-lake/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.elca.ch" target="_blank" rel="noopener noreferrer" class="footer__link-item">ELCA<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Smart Data Lake, Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>