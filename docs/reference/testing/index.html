<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Smart Data Lake Builder RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Smart Data Lake Builder Atom Feed"><title data-react-helmet="true">Testing | Smart Data Lake Builder</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://www.smartdatalake.ch/docs/reference/testing"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Testing | Smart Data Lake Builder"><meta data-react-helmet="true" name="description" content="This page is under review and currently not visible in the menu."><meta data-react-helmet="true" property="og:description" content="This page is under review and currently not visible in the menu."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://www.smartdatalake.ch/docs/reference/testing"><link data-react-helmet="true" rel="alternate" href="https://www.smartdatalake.ch/docs/reference/testing" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://www.smartdatalake.ch/docs/reference/testing" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5ed0a4ac.css">
<link rel="preload" href="/assets/js/runtime~main.d0ff1697.js" as="script">
<link rel="preload" href="/assets/js/main.b6f21789.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/sdl_logo.png" alt="Smart Data Lake Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/sdl_logo.png" alt="Smart Data Lake Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Smart Data Lake</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/JsonSchemaViewer">SchemaViewer</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><main class="docMainContainer_TCnq docMainContainerEnhanced_WDCb"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Testing</h1></header><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>This page is under review and currently not visible in the menu.</p></div></div><p>Testing is crucial for software quality and maintenance. This is also true for data pipelines.</p><p>SDL provides the following possibilities for Testing:</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="config-validation">Config validation<a class="hash-link" href="#config-validation" title="Direct link to heading">â€‹</a></h2><p>Parsing of configuration can be validated by specifying command line parameter <code>--test config</code> or programmatically:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class ConfigTest extends FunSuite with TestUtil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  test(&quot;validate configuration&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val (registry, globalConfig) = ConfigToolbox.loadAndParseConfig(Seq(&quot;src/main/resources&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert(registry.getActions.nonEmpty)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This should be done in continuous integration.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="dry-run">Dry run<a class="hash-link" href="#dry-run" title="Direct link to heading">â€‹</a></h2><p>A dry-run can be started by specifying command line parameter <code>--test dry-run</code>.
The dry-run executes only prepare and init phase. It validates configuration, checks connections and validates Spark lineage.
It doesn&#x27;t change anything in the environment.</p><p>This is suitable for smoke testing after deployment.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="custom-transformation-logic-unit-tests">Custom transformation logic unit tests<a class="hash-link" href="#custom-transformation-logic-unit-tests" title="Direct link to heading">â€‹</a></h2><p>Logic of custom transformation can easily be unit tested. Example:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class MyCustomTransformerTest extends FunSuite {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // init spark session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val sparkSession = Map(&quot;spark.default.parallelism&quot; -&gt; &quot;1&quot;, &quot;spark.sql.shuffle.partitions&quot; -&gt; &quot;1&quot;, &quot;spark.task.maxFailures&quot; -&gt; &quot;1&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lazy val session: SparkSession = GlobalConfig(enableHive = false, sparkOptions = Some(sparkSession))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .createSparkSession(&quot;test&quot;, Some(&quot;local[*]&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  import session.implicits._</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  test(&quot;test my custom transformer&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // define input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val dfInput = Seq((&quot;joe&quot;,1)).toDF(&quot;name&quot;, &quot;cnt&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // transform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val transformer = new MyCustomTransformer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val dfsInput = Map(&quot;input&quot; -&gt; dfInput)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val dfsTransformed = transformer.transform(session, Map(), dfsInput)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val dfOutput = dfsTransformed(&quot;output&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert(dfOutput.count == 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="simulation-of-spark-data-pipeline">Simulation of spark data pipeline<a class="hash-link" href="#simulation-of-spark-data-pipeline" title="Direct link to heading">â€‹</a></h2><p>Instead of testing single transformation logic, it would be interesting to test whole pipelines of spark actions.
For this you can start a simulation run programmatically. You have to provide all input data frames and get the output data frames of the end nodes of the DAG.
The simulation mode only executes the init phase with special modification, so it runs without any environment. Of course there are some exceptions like kafka/confluent schema registry.
Note that simulation mode only supports spark actions for now, you might need to choose &quot;feedSel&quot; accordingly.</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class MyDataPipelineTest extends FunSuite with TestUtil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // load config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val (registry, globalConfig) = ConfigToolbox.loadAndParseConfig(Seq(&quot;src/main/resources&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // init spark session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val sparkSession = Map(&quot;spark.default.parallelism&quot; -&gt; &quot;1&quot;, &quot;spark.sql.shuffle.partitions&quot; -&gt; &quot;1&quot;, &quot;spark.task.maxFailures&quot; -&gt; &quot;1&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lazy val session: SparkSession = GlobalConfig(enableHive = false, sparkOptions = Some(sparkSession))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .createSparkSession(&quot;test&quot;, Some(&quot;local[*]&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  import session.implicits._</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  test(&quot;enrich and process: create alarm&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // get input1 from modified data object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val input1DO = registry.get[CsvFileDataObject](&quot;input1&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .copy(connectionId = None, path = &quot;src/test/resources/sample_input1.csv&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val dfInput1 = input1DO.getDataFrame()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // define input2 manually</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val dfInput2 = Seq((&quot;joe&quot;,1)).toDF(&quot;name&quot;, &quot;cnt&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // transform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val inputSubFeeds = Seq(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SparkSubFeed(Some(dfInput1), DataObjectId(&quot;input1&quot;), Seq()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SparkSubFeed(Some(dfInput2), DataObjectId(&quot;ipnut2&quot;), Seq())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val config = SmartDataLakeBuilderConfig(feedSel = s&quot;my-feed&quot;, applicationName = Some(&quot;test&quot;), configuration = Some(&quot;test&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val sdlb = new DefaultSmartDataLakeBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val (finalSubFeeds, stats) = sdlb.startSimulation(config, inputSubFeeds)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val dfOutput = finalSubFeeds.find(_.dataObjectId.id == s&quot;output&quot;).get.dataFrame.get.cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val output = dfOutput.select($&quot;name&quot;, $&quot;test&quot;).as[(String,Boolean)].collect.toSeq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert(output == Seq((&quot;joe&quot;, true)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/smart-data-lake/smart-data-lake/tree/documentation/docs/reference/testing.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#config-validation" class="table-of-contents__link toc-highlight">Config validation</a></li><li><a href="#dry-run" class="table-of-contents__link toc-highlight">Dry run</a></li><li><a href="#custom-transformation-logic-unit-tests" class="table-of-contents__link toc-highlight">Custom transformation logic unit tests</a></li><li><a href="#simulation-of-spark-data-pipeline" class="table-of-contents__link toc-highlight">Simulation of spark data pipeline</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Getting started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/smart-data-lake/smart-data-lake/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://www.elca.ch" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>ELCA<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Smart Data Lake, Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.d0ff1697.js"></script>
<script src="/assets/js/main.b6f21789.js"></script>
</body>
</html>