<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-getting-started/part-2/historical-data" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Keeping historical data | Smart Data Lake Builder</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.smartdatalake.ch/docs/getting-started/part-2/historical-data"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Keeping historical data | Smart Data Lake Builder"><meta data-rh="true" name="description" content="Goal"><meta data-rh="true" property="og:description" content="Goal"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.smartdatalake.ch/docs/getting-started/part-2/historical-data"><link data-rh="true" rel="alternate" href="https://www.smartdatalake.ch/docs/getting-started/part-2/historical-data" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.smartdatalake.ch/docs/getting-started/part-2/historical-data" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UOM3ZOMCU0-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Smart Data Lake Builder RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Smart Data Lake Builder Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Smart Data Lake Builder" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.882ac319.css">
<script src="/assets/js/runtime~main.e05fe9cd.js" defer="defer"></script>
<script src="/assets/js/main.b4f81a6a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/sdl_logo.png" alt="Smart Data Lake Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/sdl_logo.png" alt="Smart Data Lake Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Smart Data Lake</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/json-schema-viewer">SchemaViewer</a><a href="https://ui-demo.smartdatalake.ch/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">UI-Demo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/">Smart Data Lake</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/getting-started/setup">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/setup">Technical Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/get-input-data">Inputs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/getting-started/part-1/get-departures">Part 1</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/getting-started/part-2/industrializing">Part 2</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/part-2/industrializing">Industrializing our data pipeline</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/part-2/delta-lake-format">Delta Lake - a better data format</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/getting-started/part-2/historical-data">Keeping historical data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/part-2/environments">Configure for different environments</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/getting-started/part-3/custom-webservice">Part 3</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/getting-started/troubleshooting/common-problems">Troubleshooting</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/reference/build">Reference</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/json-schema-viewer">Configuration Schema Viewer</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Getting Started</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Part 2</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Keeping historical data</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Keeping historical data</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="goal">Goal<a href="#goal" class="hash-link" aria-label="Direct link to Goal" title="Direct link to Goal">​</a></h2>
<p>Data generally can be split into two groups:</p>
<ul>
<li>Master data:<br>
<!-- -->data about objects that evolve over time, e.g. an airport, a person, a product...</li>
<li>Transactional data:<br>
<!-- -->data about events that took place at a certain point in time, e.g. a flight, a payment...</li>
</ul>
<p>To keep historical data for both these categories, different strategies are applied:</p>
<ul>
<li><strong>Master data</strong> is most often <strong>historized</strong> - this means tracking the evolution of objects over time by introducing a time dimension.
Usually this is modelled with two additional attributes &quot;valid_from&quot; and &quot;valid_to&quot;, where &quot;valid_from&quot; is an additional primary key column.</li>
<li><strong>Transactional data</strong> is usually <strong>deduplicated</strong>, as only the latest state of a specific event is of interest. If an update for an event occurs, the previous information is discarded (or consolidated in special cases).
Additional care must be taken to keep all historical events, even if they are no longer present in the source system. Often specific housekeeping rules are applied (e.g. retention period), either for legal or cost saving reasons.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a href="#requirements" class="hash-link" aria-label="Direct link to Requirements" title="Direct link to Requirements">​</a></h2>
<p>For Historization and Deduplication a data pipeline needs to read the state of the output DataObject, merge it with the new state of the input DataObject and write the result to the output DataObject.
To read and write the same DataObject in the same SDLB Action, this must be a transactional DataObject.
It means the DataObject must implement the interface TransactionalSparkTableDataObject of SDLB.
Luckily in the previous chapter we already upgraded our data pipeline to use DeltaLakeTableDataObject, which is a TransactionalSparkTableDataObject.</p>
<p>Further, we need a key to identify records for a specific object in our data, so we can build the time dimension or deduplicate records of the same object:</p>
<ul>
<li>For airport masterdata (<code>int_airports</code>) the attribute &quot;ident&quot; clearly serves this purpose.</li>
<li>For departure data (<code>int_departures</code>) it gets more complicated to identify a flight. To simplify, let&#x27;s assume we&#x27;re only interested in one flight per aircraft, departure airport and day.
The key would then be the attributes <code>icao24</code>, <code>estdepartureairport</code> and <code>trunc_date</code>.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="historization-of-airport-data">Historization of airport data<a href="#historization-of-airport-data" class="hash-link" aria-label="Direct link to Historization of airport data" title="Direct link to Historization of airport data">​</a></h2>
<p>To historize airport master data, we have to adapt our configuration as follows:</p>
<p>Add a primary key to the table definition of <code>int-airports</code>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  table {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    db = &quot;default&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    name = &quot;int_airports&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    primaryKey = [ident]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note, that a primary key can be a composite primary key, therefore you need to define an array of columns <code>[ident]</code>.</p>
<p>For the action <code>select-airport-cols</code>, change its type from <code>CopyAction</code> to <code>HistorizeAction</code>.<br>
<!-- -->While you&#x27;re at it, rename it to <code>historize-airports</code> to reflect its new function.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  historize-airports {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    type = HistorizeAction</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>With historization, this table will now get two additional columns called <code>dl_ts_captured</code> and <code>dl_ts_delimited</code>.
Schema evolution of existing tables will be explained later, so for now, just delete the table and it&#x27;s data for the DataObject <code>int-airports</code> through spark-shell and SDLB&#x27;s scala interface :</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">sdlb.dataObjects.intAirports.dataObject.dropTable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>See previous chapter for more details.</p>
<p>Then start Action <code>historize-airports</code>.
You may have seen that the <code>--feed-sel</code> parameter of SDLB command line supports more options to select actions to execute (see command line help).
We will now only execute this single action by changing this parameter to <code>--feed-sel ids:historize-airports</code>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">./startJob.sh -c /mnt/config --feed-sel ids:historize-airports</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>JDOFatalDataStoreException</div><div class="admonitionContent_BuS1"><p>Getting error <code>javax.jdo.JDOFatalDataStoreException: Unable to open a test connection to the given database</code> and <code>Another instance of Derby may have already booted the database /mnt/data/metastore_db</code>?
This is due to the fact that we are using a file-based Derby database as metastore, which can be only opened by one process at a time.
Solution: close spark-shell (Ctrl-D) before running startJob.sh.</p></div></div>
<p>After successful execution you can check the schema and data of our table in spark-shell.
It now has a time dimension through the two new columns <code>dl_ts_captured</code> and <code>dl_ts_delimited</code>.
They form a closed interval, meaning start and end time are inclusive.
It has millisecond precision, but the timestamp value is set to the current time of our data pipeline run.
The two attributes show the time period in which an object with this combination of attribute values has existed in our data source.
The sampling rate is given by the frequency that our data pipeline is scheduled.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">sdlb.dataObjects.intAirports.printSchema</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>root
|-- ident: string (nullable = true)
|-- name: string (nullable = true)
|-- latitude_deg: string (nullable = true)
|-- longitude_deg: string (nullable = true)
|-- dl_ts_captured: timestamp (nullable = true)
|-- dl_ts_delimited: timestamp (nullable = true)</p>
<p>If you look at the data, there should be only one record per object for now, as we didn&#x27;t run our data pipeline with historical data yet.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  dataIntAirports.get.orderBy($&quot;ident&quot;,$&quot;dl_ts_captured&quot;).show</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>+-----+--------------------+------------------+-------------------+--------------------+-------------------+
|ident|                name|      latitude_deg|      longitude_deg|      dl_ts_captured|    dl_ts_delimited|
+-----+--------------------+------------------+-------------------+--------------------+-------------------+
|  00A|   Total Rf Heliport|    40.07080078125| -74.93360137939453|2021-12-05 13:23:...|9999-12-31 00:00:00|
| 00AA|Aero B Ranch Airport|         38.704022|        -101.473911|2021-12-05 13:23:...|9999-12-31 00:00:00|
| 00AK|        Lowell Field|         59.947733|        -151.692524|2021-12-05 13:23:...|9999-12-31 00:00:00|
| 00AL|        Epps Airpark| 34.86479949951172| -86.77030181884766|2021-12-05 13:23:...|9999-12-31 00:00:00|
| 00AR|Newport Hospital ...|           35.6087|         -91.254898|2021-12-05 13:23:...|9999-12-31 00:00:00|
...</p>
<p>Let&#x27;s try to simulate the historization process by loading a historical state of the data and see if any of the airports have changed since then.
For this, drop table <code>int-airports</code> again.
Then, delete all files in <code>data/stg-airport</code> and copy the historical <code>result.csv</code> from the folder <code>data/stg-airports-fallback</code> into the folder <code>data/stg-airports</code>.</p>
<p>Now start the action <code>historize-airports</code> (and only historize-airports) again to do an &quot;initial load&quot;.
Remember how you do that? That&#x27;s right, you can define a single action with <code>--feed-sel ids:historize-airports</code>.<br>
<!-- -->Afterward, start actions <code>download-airports</code> and <code>historize-airports</code> by using the parameter <code>--feed-sel &#x27;ids:(download|historize)-airports&#x27;</code> to download fresh data and build up the airport history.</p>
<p>Uff, getting error <code>AnalysisException: [UNSUPPORTED_OVERWRITE.TABLE] Can&#x27;t overwrite the target that is also being read from</code>.
Recent versions of Delta Lake don&#x27;t like if we overwrite a table &quot;also being read from&quot;. Unfortunately this is what HistoryAction does.
It reads the historical data from the table, and adds new records for data changed in the current snapshot.
By default, this happens by overwriting the whole table. This is not optimal from a performance point of view, but there was no other way to change data with Hive tables.
As Delta Lake supports merge statement, we can add <code>mergeModeEnable = true</code> to our HistorizeAction configuration as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  historize-airports {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    type = HistorizeAction</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    inputId = stg-airports</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    outputId = int-airports    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    mergeModeEnable = true</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Merge Mode</div><div class="admonitionContent_BuS1"><p><code>mergeModeEnable = true</code> tells Deduplicate/HistorizeAction to merge changed data into the output DataObject, instead of overwriting the whole DataObject.
The output DataObject must implement CanMergeDataFrame interface (also called trait in Scala) for this.
DeltaLakeTableDataObject will then create a complex SQL-Upsert statement to merge new and changed data into existing output data.</p></div></div>
<p>Uff, getting error <code>&#x27;SchemaViolationException: (DataObject~int-airports) Schema does not match schema defined on write:</code> with <code>superfluousCols=dl_hash</code>?
This is due to merge mode needing an additional column <code>dl_hash</code> to efficiently check for changed data.
Drop table <code>int-airports</code> again, then startJob <code>--feed-sel ids:historize-airports</code> and afterward <code>--feed-sel &#x27;ids:(download|historize)-airports&#x27;</code>.</p>
<p>Now check in spark-shell again, and you&#x27;ll find several airports that have changed between the initial and the current state:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  sdlb.dataObjects.intAirports.get</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  .groupBy($&quot;ident&quot;).count</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  .orderBy($&quot;count&quot;.desc)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  .show</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>+-------+-----+
|  ident|count|
+-------+-----+
|RU-4111|    2|
|   LL33|    2|
|   73CA|    2|
|CA-0120|    2|
|   CDV3|    2|
...</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Tips for spark-shell</div><div class="admonitionContent_BuS1"><p>You may have noticed that pasting multi-line text into spark-shell executes every line separately.
This works in the example above, but does not work with every scala code. Also, it doesn&#x27;t look that nice to see all intermediate results.</p><p>Enter <code>:paste</code> in spark-shell before pasting multi-line text for a better experience.</p><p>Also, keep in mind you can autocomplete commands with the tab key. This allows you for instance to autocomplete the commands of the SDLB Interface.</p></div></div>
<p>When checking the details it seems that for many airports the number of significant digits was reduced for the position:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  sdlb.dataObjects.intAirports.get</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  .where($&quot;ident&quot;===&quot;CDV3&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  .drop(&quot;dl_hash&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  .show(false)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>+-----+-------------------------------------------------+-------------+--------------+--------------------------+--------------------------+
|ident|name                                             |latitude_deg |longitude_deg |dl_ts_captured            |dl_ts_delimited           |
+-----+-------------------------------------------------+-------------+--------------+--------------------------+--------------------------+
|CDV3 |Charlottetown (Queen Elizabeth Hospital) Heliport|46.255493    |-63.098887    |2021-12-05 20:52:58.800645|9999-12-31 00:00:00       |
|CDV3 |Charlottetown (Queen Elizabeth Hospital) Heliport|46.2554925916|-63.0988866091|2021-12-05 20:40:31.629764|2021-12-05 20:52:58.799645|
+-----+-------------------------------------------------+-------------+--------------+--------------------------+--------------------------+</p>
<p>Values for <code>dl_ts_capture</code> and <code>dl_ts_delimited</code> respectively were set to the current time of our data pipeline run.
For an initial load, this should be set to the time of the historical data set.
Currently, this is not possible in SDLB, but there are plans to implement this, see issue <a href="https://github.com/smart-data-lake/smart-data-lake/issues/427" target="_blank" rel="noopener noreferrer">#427</a>.</p>
<p>If you would try to run <code>download-airports</code> and <code>historize-airports</code> Action in a fresh environment (data/stg-airports directory removed),
the job would fail with <code>requirement failed: (DataObject~stg-airports) DataObject schema is undefined.</code> in prepare phase.
This is bug <a href="https://github.com/smart-data-lake/smart-data-lake/issues/900" target="_blank" rel="noopener noreferrer">#900</a>.
For now lets make it more stable by adding a fixed schema to <code>stg-airports</code> DataObject as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  stg-airports {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    type = CsvFileDataObject</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    path = ${env.basePath}&quot;~{id}&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    schema = &quot;id string, ident string, type string, name string, latitude_deg string, longitude_deg string, elevation_ft string, continent string, iso_country string, iso_region string, municipality string, scheduled_service string, gps_code string, iata_code string, local_code string, home_link string, wikipedia_link string, keywords string&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now let&#x27;s continue with flight data.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Spark performance</div><div class="admonitionContent_BuS1"><p>Spark automatically splits jobs into multiple tasks to distribute to its workers. This is how Spark can process large scale datasets.
The HistorizeAction needs to join all existing data with the new input data and check for changes.<br>
<!-- -->If Spark joins data, it needs two processing stages and a shuffle in between to do so (you can read more about this in various Spark tutorials).
There is a Spark property we can tune for small datasets to reduce the number of tasks created.
The default value is to create 200 tasks in each shuffle. With our dataset, 2 tasks should be enough already.
You can tune this by setting the following property in global.spark-options of global.conf configuration file:</p><p>&quot;spark.sql.shuffle.partitions&quot; = 2</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deduplication-of-flight-data">Deduplication of flight data<a href="#deduplication-of-flight-data" class="hash-link" aria-label="Direct link to Deduplication of flight data" title="Direct link to Deduplication of flight data">​</a></h2>
<p>To deduplicate departure flight data, we have to adapt our configuration as follows:</p>
<p>Add a primary key to the table definition of <code>int-departures</code>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  table {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    db = &quot;default&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    name = &quot;int_departures&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    primaryKey = [icao24, estdepartureairport, dt]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Change the type of action <code>prepare-departures</code> from <code>CopyAction</code>, this time to <code>DeduplicateAction</code> and rename it to <code>deduplicate-departures</code>, again to reflect its new type.
It also needs an additional transformers to calculate the new primary key column <code>dt</code> derived from the column <code>firstseen</code>, and to make sure input data is unique across the primary key of the output DataObject.
Finally, we need to set <code>mergeModeEnable = true</code> and <code>updateCapturedColumnOnlyWhenChanged = true</code>.</p>
<p>The <code>deduplicate-departures</code> Action definition should then look as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  deduplicate-departures {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    type = DeduplicateAction</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    inputId = stg-departures</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    outputId = int-departures</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    mergeModeEnable = true</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    updateCapturedColumnOnlyWhenChanged = true</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    transformers = [{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      type = SQLDfTransformer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      code = &quot;select stg_departures.*, date_format(from_unixtime(firstseen),&#x27;yyyyMMdd&#x27;) dt from stg_departures&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    },{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      type = DeduplicateTransformer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      rankingExpression = &quot;lastSeen desc&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Effect of updateCapturedColumnOnlyWhenChanged</div><div class="admonitionContent_BuS1"><p>By default DeduplicateAction updates column dl_captured in the output for every record it receives. To reduce the number of updated records, <code>updateCapturedColumnOnlyWhenChanged = true</code> can be set.
In this case column dl_captured is only updated in the output, when some attribute of the record changed.</p></div></div>
<p>Now, delete the table and data of the DataObject <code>int-departures</code> in spark-shell, to prepare it for the new columns <code>dt</code> and <code>dl_ts_captured</code>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">sdlb.dataObjects.intDepartures.dataObject.dropTable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then start Action deduplicate-departures:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">./startJob.sh -c /mnt/config --feed-sel ids:deduplicate-departures</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After successful execution you can check the schema and data of our table in spark-shell.
The new column <code>dl_ts_captured</code> shows the current time of the data pipeline run when this object first occurred in the input data.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  sdlb.dataObjects.intDepartures.printSchema</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>prints:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  root</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  |-- arrivalairportcandidatescount: long (nullable = true)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  |-- callsign: string (nullable = true)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  |-- departureairportcandidatescount: long (nullable = true)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  |-- estarrivalairport: string (nullable = true)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  |-- estarrivalairporthorizdistance: long (nullable = true)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  |-- estarrivalairportvertdistance: long (nullable = true)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  |-- estdepartureairport: string (nullable = true)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  |-- estdepartureairporthorizdistance: long (nullable = true)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  |-- estdepartureairportvertdistance: long (nullable = true)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  |-- firstseen: long (nullable = true)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  |-- icao24: string (nullable = true)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  |-- lastseen: long (nullable = true)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  |-- dt: string (nullable = true)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  |-- dl_ts_captured: timestamp (nullable = true)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can check the work of DeduplicateAction by the following query in spark-shell:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">sdlb.dataObjects.intDepartures.get</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">.groupBy($&quot;icao24&quot;, $&quot;estdepartureairport&quot;, $&quot;dt&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">.count</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">.orderBy($&quot;count&quot;.desc)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">.show</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>+------+-------------------+--------+-----+
|icao24|estdepartureairport|      dt|count|
+------+-------------------+--------+-----+
|4b43ab|               LSZB|20210829|    1|
|4b4b8d|               LSZB|20210829|    1|
|4b1b13|               LSZB|20210829|    1|
|4b4445|               LSZB|20210829|    1|
|4b0f70|               LSZB|20210830|    1|
|4b1a01|               LSZB|20210829|    1|
|346603|               LSZB|20210829|    1|
|4b4442|               LSZB|20210829|    1|
|4d02d7|               LSZB|20210829|    1|
|4b43ab|               LSZB|20210830|    1|
...</p>
<p>Note that DeduplicateAction assumes that input data is already unique across the given primary key. With <code>mergeModeEnable = true</code> we even get errors otherwise.
DeduplicateAction doesn&#x27;t deduplicate your input data by default, because deduplication is costly and data often is already unique.
In our example we have duplicates in the input data set, and added the DeduplicateTransformer to our input data.
Instead of using DeduplicateTransformer, we could also implement our own deduplicate logic using the Scala Spark API with ScalaCodeSparkDfTransformer as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    transformers = [{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      type = ScalaCodeSparkDfTransformer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      code = &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        import org.apache.spark.sql.{DataFrame, SparkSession}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        def transform(session: SparkSession, options: Map[String,String], df: DataFrame, dataObjectId: String) : DataFrame = {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          import session.implicits._</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          df.dropDuplicates(&quot;icao24&quot;, &quot;estdepartureairport&quot;, &quot;dt&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        // return as function</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        transform _</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Note how we have used a third way of defining transformation logic now:<br>
<!-- -->In part 1 we first used a SQLDfsTransformer writing SQL code.<br>
<!-- -->Then for the more complex example of computing distances, we used a ScalaClassSparkDfTransformer pointing to a Scala class.<br>
<!-- -->Here, we simply include Scala code in our configuration file directly.</p></div></div>
<p>For sure DeduplicateAction did not have much work to do, as this was the first data load.
In order to get different data you would need to adjust the unix timestamp parameters in the URL of DataObject <code>ext-departures</code>.
Feel free to play around.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Scala Code</div><div class="admonitionContent_BuS1"><p>Scala is a compiled language. The compiler creates bytecode which can be run on a JVM.
Normally compilation takes place before execution. So how does it work with scala code in the configuration as in our deduplication logic above?</p><p>With Scala, you can compile code on the fly. This is actually what the Scala Shell/REPL is doing as well.
The Scala code in the configuration above gets compiled when ScalaCodeSparkDfTransformer is instantiated during startup of SDLB.</p></div></div>
<p>Your departures/airports.conf should now look like the files ending with <code>part-2b-solution</code> in <a href="https://github.com/smart-data-lake/getting-started/tree/master/config" target="_blank" rel="noopener noreferrer">this directory</a>.</p>
<p>In the next step we are going to configure the pipeline for different environments like development, integration and production.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/smart-data-lake/smart-data-lake/tree/documentation/docs/getting-started/part-2/historical-data.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/getting-started/part-2/delta-lake-format"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Delta Lake - a better data format</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/getting-started/part-2/environments"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Configure for different environments</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#goal" class="table-of-contents__link toc-highlight">Goal</a></li><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a></li><li><a href="#historization-of-airport-data" class="table-of-contents__link toc-highlight">Historization of airport data</a></li><li><a href="#deduplication-of-flight-data" class="table-of-contents__link toc-highlight">Deduplication of flight data</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">Get started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/smart-data-lake/smart-data-lake/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.elca.ch" target="_blank" rel="noopener noreferrer" class="footer__link-item">ELCA<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Smart Data Lake, Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>