<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-getting-started/part-3/incremental-mode">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Smart Data Lake Builder RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Smart Data Lake Builder Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Smart Data Lake Builder" href="/opensearch.xml"><title data-rh="true">Incremental Mode | Smart Data Lake Builder</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.smartdatalake.ch/docs/getting-started/part-3/incremental-mode"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Incremental Mode | Smart Data Lake Builder"><meta data-rh="true" name="description" content="Goal"><meta data-rh="true" property="og:description" content="Goal"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.smartdatalake.ch/docs/getting-started/part-3/incremental-mode"><link data-rh="true" rel="alternate" href="https://www.smartdatalake.ch/docs/getting-started/part-3/incremental-mode" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.smartdatalake.ch/docs/getting-started/part-3/incremental-mode" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UOM3ZOMCU0-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.0f640fc3.css">
<link rel="preload" href="/assets/js/runtime~main.9dadea2a.js" as="script">
<link rel="preload" href="/assets/js/main.6d7b9910.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/sdl_logo.png" alt="Smart Data Lake Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/sdl_logo.png" alt="Smart Data Lake Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Smart Data Lake</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/JsonSchemaViewer">SchemaViewer</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/">Smart Data Lake</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/getting-started/setup">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/setup">Technical Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/get-input-data">Inputs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/getting-started/part-1/get-departures">Part 1</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/getting-started/part-2/industrializing">Part 2</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/getting-started/part-3/custom-webservice">Part 3</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/part-3/custom-webservice">Custom Webservice</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/getting-started/part-3/incremental-mode">Incremental Mode</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/getting-started/troubleshooting/common-problems">Troubleshooting</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/reference/build">Reference</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/JsonSchemaViewer">Configuration Schema Viewer</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Getting Started</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Part 3</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Incremental Mode</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Incremental Mode</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="goal">Goal<a class="hash-link" href="#goal" title="Direct link to heading">​</a></h2><p>The goal of this part is to use the DataObject&#x27;s state, such that it can be used in subsequent requests.
This allows for more dynamic querying of the API.
For example in the <code>ext-departures</code> DataObject we currently query the API with fixed airport, begin and end query parameters.
Consequently, we will always query the same time period for a given airport.
In a more real-world example, we would want a delta load mechanism that loads any new data since the last execution of the action.
To demonstrate these incremental queries based on previous state we will start by rewriting our configuration file.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="define-data-objects">Define Data Objects<a class="hash-link" href="#define-data-objects" title="Direct link to heading">​</a></h2><p>We only make the following minor changes in our config file to Action <code>download-deduplicate-departures</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">download-deduplicate-departures {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = DeduplicateAction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  inputId = ext-departures</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  outputId = int-departures</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  executionMode = { type = DataObjectStateIncrementalMode }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mergeModeEnable = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  updateCapturedColumnOnlyWhenChanged = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  transformers = [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type = SQLDfTransformer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    code = &quot;select ext_departures.*, date_format(from_unixtime(firstseen),&#x27;yyyyMMdd&#x27;) dt from ext_departures&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type = ScalaCodeSparkDfTransformer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    code = &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      import org.apache.spark.sql.{DataFrame, SparkSession}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      def transform(session: SparkSession, options: Map[String,String], df: DataFrame, dataObjectId: String) : DataFrame = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        import session.implicits._</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        df.dropDuplicates(&quot;icao24&quot;, &quot;estdepartureairport&quot;, &quot;dt&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // return as function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      transform _</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  metadata {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    feed = deduplicate-departures</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Adding the executionMode <code>DataObjectStateIncrementalMode</code> will enable DataObject incremental mode. With every run the input DataObject will only return new data in this mode.
The DataObject saves its state in the global state file that is written after each run of the Smart Data Lake Builder. You haven&#x27;t worked with this state file before, more on that later.</li><li><code>mergeModeEnable = true</code> tells DeduplicateAction to merge changed data into the output DataObject, instead of overwriting the whole DataObject. This is especially useful if incoming data is read incrementally.
The output DataObject must implement CanMergeDataFrame interface (also called trait in Scala) for this. DeltaLakeTableDataObject will then create a complex SQL-Upsert statement to merge new and changed data into existing output data.</li><li>By default DeduplicateAction updates column dl_captured in the output for every record it receives. To reduce the number of updated records, <code>updateCapturedColumnOnlyWhenChanged = true</code> can be set.
In this case column dl_captured is only updated in the output, when some attribute of the record changed.</li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Execution mode is also something that is going to be explained in more detail later.
For now, just think of the execution mode as a way to select which data needs to be processed.
In this case, we tell Smart Data Lake Builder to load data based on the state stored in the DataObject itself.</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>Remember that the time interval in <code>ext-departures</code> should not be larger than a week. As mentioned, we will implement a simple incremental query logic that always queries from the last execution time until the current execution.
If the time difference between the last execution and the current execution time is larger than a week, we will query the next four days since the last execution time. Otherwise we query the data from the last execution until now.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="define-state-variables">Define state variables<a class="hash-link" href="#define-state-variables" title="Direct link to heading">​</a></h2><p>To make use of the newly configured execution mode, we need state variables. Add the following two variables to our CustomWebserviceDataObject.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  private var previousState : Seq[State] = Seq()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private var nextState : Seq[State] = Seq()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The corresponding <code>State</code> case class is defined as </p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  case class State(airport: String, nextBegin: Long)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and should be added in the same file outside the DataObject. For example, add it just below the already existing case classes.
The state always stores the <code>airport</code> and a <code>nextBegin</code> as unix timestamp to indicate to the next run, what data needs to be loaded. </p><p>Concerning the state variables, <code>previousState</code> will basically be used for all the logic of the DataObject and <code>nextState</code> will be used to store the state for the next run.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="read-and-write-state">Read and write state<a class="hash-link" href="#read-and-write-state" title="Direct link to heading">​</a></h2><p>To actually work with the state, we need to implement the <code>CanCreateIncrementalOutput</code> trait.
This can be done by adding <code>with CanCreateIncrementalOutput</code> to the <code>CustomWebserviceDataObject</code>.
Consequently, we need to implement the functions <code>setState</code> and <code>getState</code> defined in the trait. </p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">override def setState(state: Option[String])(implicit context: ActionPipelineContext): Unit = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  implicit val formats: Formats = DefaultFormats</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  previousState = state.map(s =&gt; JsonMethods.parse(s).extract[Seq[State]]).getOrElse(Seq())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">override def getState: Option[String] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  implicit val formats: Formats = DefaultFormats</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Some(Serialization.write(nextState))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can see that by implementing these two functions, we start using the variables defined in the section above.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="try-it-out">Try it out<a class="hash-link" href="#try-it-out" title="Direct link to heading">​</a></h2><p>We only spoke about this state, but it was never explained where it is stored.
To work with a state, we need to introduce two new command line parameters: <code>--state-path</code> and <code>--name</code> or <code>-n</code> in short.
This allows us to define the folder and name of the state file.
To have access to the state file, we specify the path to be in an already mounted folder.</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Docker</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Podman</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">v $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">PWD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mnt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">project </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">v $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">PWD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">/</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mvnrepo</span><span class="token operator" style="color:#393A34">:</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">mnt</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mvnrepo</span><span class="token plain"> maven</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3.6</span><span class="token number" style="color:#36acaa">.0</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">jdk</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">11</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slim </span><span class="token operator" style="color:#393A34">--</span><span class="token plain"> mvn </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">f </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mnt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">project</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">xml</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-Dmaven.repo.local=/mnt/.mvnrepo&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">package</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">rm </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">v $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">PWD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mnt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">data </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">v $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">PWD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">target</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mnt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">lib </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">v $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">PWD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">config</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mnt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">config </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">network getting</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">started_default sdl</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">spark</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">latest </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">config </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mnt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">config </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">feed</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">sel ids</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">download</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">deduplicate</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">departures </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">path </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mnt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">state </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">n getting</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">started</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">podman run </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">v $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">PWD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mnt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">project </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">v $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">PWD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">/</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mvnrepo</span><span class="token operator" style="color:#393A34">:</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">mnt</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mvnrepo</span><span class="token plain"> maven</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3.6</span><span class="token number" style="color:#36acaa">.0</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">jdk</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">11</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slim </span><span class="token operator" style="color:#393A34">--</span><span class="token plain"> mvn </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">f </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mnt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">project</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">pom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">xml</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-Dmaven.repo.local=/mnt/.mvnrepo&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">package</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">podman run </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">rm </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">v $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">PWD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mnt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">data </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">v $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">PWD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">target</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mnt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">lib </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">v $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">PWD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">config</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mnt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">config </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">hostname</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">localhost </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">pod getting</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">started sdl</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">spark</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">latest </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">config </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mnt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">config </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">feed</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">sel ids</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">download</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">deduplicate</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">departures </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">state</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">path </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mnt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">state </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">n getting</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">started</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p>Use this slightly modified command to run <code>download-deduplicate-departures</code> Action.
Nothing should have changed so far, since we only read and write an empty state.<br>
<!-- -->You can verify this by opening the file <code>getting-started.&lt;runId&gt;.&lt;attemptId&gt;.json</code> and having a look at the field <code>dataObjectsState</code>. The stored state is currently empty.
In the next section, we will assign a value to <code>nextState</code>, such that the <code>DataObject&#x27;s</code> state is written. </p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>The same state file is used by Smart Data Lake Builder to enable automatic recoveries of failed jobs.
This will also be explained in detail separately, but we&#x27;re mentioning the fact here, so you can understand the two variables <code>&lt;runId&gt;</code> and <code>&lt;attemptId&gt;</code> appearing in the file name.
For each execution, the <code>&lt;runId&gt;</code> is incremented by one.
The <code>&lt;attemptId&gt;</code> is usually 1, but gets increased by one if Smart Data Lake Builder has to recover a failed execution.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="define-a-query-logic">Define a Query Logic<a class="hash-link" href="#define-a-query-logic" title="Direct link to heading">​</a></h2><p>Now we want to achieve the following query logic:</p><p>The starting point are the query parameters provided in the configuration file and no previous state.
During the first execution, we query the departures for the two airports in the given time window.
Afterwards, the <code>end</code>-parameter of the current query will be stored as <code>begin</code>-parameter for the next query.
Now the true incremental phase starts as we can now get the state of the last successful run.
We query the flight-data API to get data from the last successful run up until now.
For this to work, we need to make two changes. First add the variable</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private val now = Instant.now.getEpochSecond</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>just below the <code>nextState</code> variable. Then modify the <code>currentQueryParameters</code> variable according to</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// if we have query parameters in the state we will use them from now on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">val currentQueryParameters = if (previousState.isEmpty) checkQueryParameters(queryParameters) else checkQueryParameters(previousState.map{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  x =&gt; DepartureQueryParameters(x.airport, x.nextBegin, now)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The implemented logic </p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nextState = currentQueryParameters.map(params =&gt; State(params.airport, params.end))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>for the next state can be placed below the comment <code>// put simple nextState logic below</code>. </p><p>Compile and execute the code of this project again and execute it multiple times.
The scenario will be that the first run fetches the data defined in the configuration file, then the proceeding run retrieves the data from the endpoint of the last run until now.
If this time difference is larger than a week, the program only queries the next four days since the last execution.
If there is no data available in a time window, because only a few seconds have passed since the last execution, the execution will fail with Error <strong>404</strong>.</p><p>At the end your config file should look something like <a target="_blank" href="/assets/files/application-part3-download-incremental-mode-94f57db928615c7216b82f655dd11d5c.conf">this</a> and the CustomWebserviceDataObject code like <a target="_blank" href="/assets/files/CustomWebserviceDataObject-2-03fe1158d189cf1bd05ab35b7bcd8768.scala">this</a>.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Unfortunately, the webservice on opensky-network.org responds with a <strong>404</strong> error code when no data is available, rather than a <strong>200</strong> and an empty response.
Therefore, SDLB gets a 404 and will fail the execution. The exception could be catched inside CustomWebserviceDataObject, but what if we have a real 404 error?!</p></div></div><p>Congratulation, you just completed implementing a nice incremental loading mechanism!</p><p>That&#x27;s it from getting-started for now. We hope you enjoyed your first steps with SDLB.
For further information, check the rest of the documentation and the blog on this page!</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/smart-data-lake/smart-data-lake/tree/documentation/docs/getting-started/part-3/incremental-mode.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/getting-started/part-3/custom-webservice"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Custom Webservice</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/getting-started/troubleshooting/common-problems"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Common Problems</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#goal" class="table-of-contents__link toc-highlight">Goal</a></li><li><a href="#define-data-objects" class="table-of-contents__link toc-highlight">Define Data Objects</a></li><li><a href="#define-state-variables" class="table-of-contents__link toc-highlight">Define state variables</a></li><li><a href="#read-and-write-state" class="table-of-contents__link toc-highlight">Read and write state</a></li><li><a href="#try-it-out" class="table-of-contents__link toc-highlight">Try it out</a></li><li><a href="#define-a-query-logic" class="table-of-contents__link toc-highlight">Define a Query Logic</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">Getting started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/smart-data-lake/smart-data-lake" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/smart-data-lake/smart-data-lake/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.elca.ch" target="_blank" rel="noopener noreferrer" class="footer__link-item">ELCA<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Smart Data Lake, Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.9dadea2a.js"></script>
<script src="/assets/js/main.6d7b9910.js"></script>
</body>
</html>